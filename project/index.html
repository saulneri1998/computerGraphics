<html>

<head>
    <title> Gears </title>
    <style>
        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>

<body>
    <script src="three.min.js">
    </script>
    <script src="OBJLoader.js">
    </script>

    <script>
        window.addEventListener('keydown', doKeyDown, true);
        var cam_zpos = 10.0;
        var cam_xpos = 0.0;
        var cam_ypos = 5.0;

        var Pi = 3.1415926535;
        var ang_rad = 0;
        var up_down_ang = 0;

        var carAngle = 0;
        var tireAngle = 0;

        var droneReleased = false;

        var horse1Up = true;
        var horse2Up = false;
        var horse3Up = true;
        var horse4Up = false;
        var horse5Up = true;

        function doKeyDown(evt) {
            evt.preventDefault();
            console.log("Tecla picada: " + evt.keyCode);
            switch (evt.keyCode) {
                case 38:
                    /* Up arrow was pressed */
                    var dx = 0.5 * Math.sin(ang_rad);
                    var dz = 0.5 * Math.cos(ang_rad);
                    cam_zpos -= dz;
                    cam_xpos -= dx;
                    break;
                case 40:
                    /* Down arrow was pressed */
                    var dx = 0.5 * Math.sin(ang_rad);
                    var dz = 0.5 * Math.cos(ang_rad);
                    cam_zpos += dz;
                    cam_xpos += dx;
                    break;
                case 37:
                    /* Left arrow was pressed */
                    ang_rad += (5 * Pi / 180);
                    break;
                case 39:
                    /* Right arrow was pressed */
                    ang_rad -= (5 * Pi / 180);
                    break;
                case 87:
                    /* W was pressed */
                    camera.position.y += 0.5;
                    break;
                case 83:
                    /* S was pressed */
                    camera.position.y -= 0.5;
                    break;
                case 65:
                    /* A was pressed */
                    var dx = 0.5 * Math.sin(ang_rad + (Pi / 2));
                    var dz = 0.5 * Math.cos(ang_rad + (Pi / 2));
                    cam_zpos -= dz;
                    cam_xpos -= dx;
                    break;
                case 68:
                    /* D was pressed */
                    var dx = 0.5 * Math.sin(ang_rad - (Pi / 2));
                    var dz = 0.5 * Math.cos(ang_rad - (Pi / 2));
                    cam_zpos -= dz;
                    cam_xpos -= dx;
                    break;

                    /* - - - Abrir y cerrar puertas - - - */
                case 74:
                    /*J pressed  - - - close door*/
                    if (carDoor1.rotation.y > -Math.PI / 2) {
                        carDoor1.rotation.y -= 0.05;
                    }
                    if (carDoor2.rotation.y < -Math.PI / 2) {
                        carDoor2.rotation.y += 0.05;
                    }
                    break;
                case 85:
                    /*U pressed  - - - open door*/
                    if (carDoor1.rotation.y < -0.43) {
                        carDoor1.rotation.y += 0.05;
                    }
                    if (carDoor2.rotation.y > -2.7) {
                        carDoor2.rotation.y -= 0.05;
                    }
                    break;

                    /* - - - Open close hood - - - */
                case 82:
                    /*R pressed  - - - close hood*/
                    if (carHoodTop.rotation.x < -Math.PI / 2) {
                        carHoodTop.rotation.x += .05;
                    }
                    break;

                case 89:
                    /*Y pressed  - - - open hood */
                    if (carHoodTop.rotation.x > -2.5) {
                        carHoodTop.rotation.x -= .05;
                    }
                    break;

                    /* - - - Open close trunk - - - */
                case 86:
                    /*V pressed  - - - open trunk*/
                    if (carTrunkTop.rotation.x < 2.5) {
                        carTrunkTop.rotation.x += .05;
                    }
                    break;

                case 66:
                    /*B pressed  - - - close trunk */
                    if (carTrunkTop.rotation.x > Math.PI / 2) {
                        carTrunkTop.rotation.x -= .05;
                    }
                    break;

                    /* - - - Rotate wheels - - - */
                case 72:
                    /*H pressed  - - - turn right*/
                    if (carTire1.rotation.y > -0.8) {
                        carTire1.rotation.y -= 0.1;
                        carTire2.rotation.y -= 0.1;
                        tireAngle -= 0.1;
                    }
                    break;
                case 70:
                    /*F pressed  - - - turn left*/
                    if (carTire1.rotation.y < 0.8) {
                        carTire1.rotation.y += 0.1;
                        carTire2.rotation.y += 0.1;
                        tireAngle += 0.1;
                    }
                    break;

                    /* - - - Move car - - - */
                case 84:
                    /*H pressed  - - - move forward*/
                    car.position.z += 1.5 * Math.cos(carAngle + tireAngle);
                    car.position.x += 1.5 * Math.sin(carAngle + tireAngle);
                    car.rotateY(tireAngle);
                    carAngle += tireAngle;
                    break;
                case 71:
                    /*F pressed  - - - move backward*/
                    car.position.z -= 1.5 * Math.cos(carAngle - tireAngle);
                    car.position.x -= 1.5 * Math.sin(carAngle - tireAngle);
                    car.rotateY(-tireAngle);
                    carAngle -= tireAngle;
                    break;

                    /* - - - Control drone - - - */
                case 88:
                    /*X pressed  - - - release / reattach drone*/
                    droneReleased = !droneReleased;
                    break;
            }
        }

        // three basic components of a scene
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.01, 1000);
        var renderer = new THREE.WebGLRenderer();

        var darkGrayMaterial = new THREE.MeshLambertMaterial({
            color: 0x555555
        });
        var blackMaterial = new THREE.MeshLambertMaterial({
            color: 0x000000
        });
        var yellowMaterial = new THREE.MeshLambertMaterial({
            color: 0xdddd00
        })

        var windowMaterial = new THREE.MeshPhongMaterial({
            color: 0x2194ce,
            shininess: 100,
            transparent: true,
            opacity: 0.6
        });
        var metalMaterial = new THREE.MeshLambertMaterial({
            map: THREE.ImageUtils.loadTexture("metal2.jpg")
        });
        var darkRedMaterial = new THREE.MeshLambertMaterial({
            map: THREE.ImageUtils.loadTexture("darkRedMetal.jpg")
        });
        var redMaterial = new THREE.MeshLambertMaterial({
            map: THREE.ImageUtils.loadTexture("redMetal.jpg")
        });
        var marble1Material = new THREE.MeshLambertMaterial({
            map: THREE.ImageUtils.loadTexture("marble.jpg")
        });
        var marble2Material = new THREE.MeshLambertMaterial({
            map: THREE.ImageUtils.loadTexture("marble2.jpg")
        });

        var lightBlueMaterial = new THREE.MeshLambertMaterial({
            color: 0xA3DCF8
        });

        var extrudeSettings = {
            steps: 2,
            depth: 0.1,
            bevelEnabled: false
        };

        var car = new THREE.Object3D();

        var carBottomShape = new THREE.Shape();
        carBottomShape.moveTo(-1, 1.5);
        carBottomShape.lineTo(1, 1.5);
        carBottomShape.lineTo(1, 1.3);
        carBottomShape.lineTo(0.8, 1.3);
        carBottomShape.lineTo(0.8, -1.3);
        carBottomShape.lineTo(1, -1.3);
        carBottomShape.lineTo(1, -1.5);
        carBottomShape.lineTo(-1, -1.5);
        carBottomShape.lineTo(-1, -1.3);
        carBottomShape.lineTo(-0.8, -1.3);
        carBottomShape.lineTo(-0.8, 1.3);
        carBottomShape.lineTo(-1, 1.3);
        carBottomShape.lineTo(-1, 1.5);
        var carBottomGeom = new THREE.ExtrudeGeometry(carBottomShape, extrudeSettings);
        var carBottom = new THREE.Mesh(carBottomGeom, darkGrayMaterial);
        carBottom.rotateX(Math.PI / 2);

        var carFrontShape = new THREE.Shape();
        carFrontShape.moveTo(-0.8, 0.3);
        carFrontShape.lineTo(-0.5, 0.3);
        carFrontShape.lineTo(-0.5, -0.1);
        carFrontShape.lineTo(0.5, -0.1);
        carFrontShape.lineTo(0.5, 0.3);
        carFrontShape.lineTo(0.8, 0.3);
        carFrontShape.lineTo(0.8, -0.3);
        carFrontShape.lineTo(-0.8, -0.3);
        carFrontShape.lineTo(-0.8, 0.3);
        var carFrontGeom = new THREE.ExtrudeGeometry(carFrontShape, extrudeSettings);
        var carFront = new THREE.Mesh(carFrontGeom, redMaterial);
        carFront.position.z += 1.3;
        carFront.position.y += 0.3;

        var carLight1 = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 0.01, 128, 1), blackMaterial);
        var carLight1inner = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.08, 0.02, 128, 1), yellowMaterial);
        carLight1.add(carLight1inner)
        carFront.add(carLight1);
        carLight1.rotateX(Math.PI / 2);
        carLight1.position.z += 0.1;
        carLight1.position.x -= 0.65;

        var carLight2 = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 0.01, 128, 1), blackMaterial);
        var carLight2inner = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.08, 0.02, 128, 1), yellowMaterial);
        carLight2.add(carLight2inner)
        carFront.add(carLight2);
        carLight2.rotateX(Math.PI / 2);
        carLight2.position.z += 0.1;
        carLight2.position.x += 0.65;

        var carSideShape = new THREE.Shape();
        carSideShape.moveTo(-1.3, 0.2);
        carSideShape.lineTo(-0.5, 0.2);

        carSideShape.lineTo(-0.2, 0.4);
        carSideShape.lineTo(-0.2, 0);
        carSideShape.lineTo(0.4, 0);

        carSideShape.lineTo(0.5, 0.3);
        carSideShape.lineTo(1.3, 0.3);
        carSideShape.lineTo(1.3, -0.3);
        carSideShape.lineTo(1.1, -0.3);
        carSideShape.lineTo(1.1, -0.15);
        carSideShape.lineTo(0.9, 0);
        carSideShape.lineTo(0.7, 0);
        carSideShape.lineTo(0.5, -0.15);
        carSideShape.lineTo(0.5, -0.3);
        carSideShape.lineTo(-0.5, -0.3);
        carSideShape.lineTo(-0.5, -0.15);
        carSideShape.lineTo(-0.7, 0);
        carSideShape.lineTo(-0.9, 0);
        carSideShape.lineTo(-1.1, -0.15);
        carSideShape.lineTo(-1.1, -0.3);
        carSideShape.lineTo(-1.3, -0.3);
        carSideShape.lineTo(-1.3, 0.2);
        var carSideGeom = new THREE.ExtrudeGeometry(carSideShape, extrudeSettings);

        var carSide1 = new THREE.Mesh(carSideGeom, redMaterial);
        carSide1.rotateY(Math.PI / 2);
        carSide1.position.x -= 0.8;
        carSide1.position.y += 0.3;

        var carSide2 = new THREE.Mesh(carSideGeom, redMaterial);
        carSide2.rotateY(Math.PI / 2);
        carSide2.position.x += 0.7;
        carSide2.position.y += 0.3;

        var carFenderShape = new THREE.Shape();
        carFenderShape.moveTo(-0.4, -0.15);
        carFenderShape.lineTo(-0.4, 0.05);
        carFenderShape.lineTo(-0.15, 0.25);
        carFenderShape.lineTo(0.15, 0.25);
        carFenderShape.lineTo(0.4, 0.05);
        carFenderShape.lineTo(0.4, -0.15);
        carFenderShape.lineTo(0.3, -0.15);
        carFenderShape.lineTo(0.3, 0);
        carFenderShape.lineTo(0.1, 0.15);
        carFenderShape.lineTo(-0.1, 0.15);
        carFenderShape.lineTo(-0.3, 0);
        carFenderShape.lineTo(-0.3, -0.15);
        carFenderShape.lineTo(-0.4, -0.15);

        var carFenderGeom = new THREE.ExtrudeGeometry(carFenderShape, extrudeSettings);
        var carFender1 = new THREE.Mesh(carFenderGeom, darkGrayMaterial);
        carFender1.rotateY(Math.PI / 2);
        carFender1.position.x -= 0.9;
        carFender1.position.z -= 0.8;
        carFender1.position.y += 0.1;

        var carFender2 = new THREE.Mesh(carFenderGeom, darkGrayMaterial);
        carFender2.rotateY(Math.PI / 2);
        carFender2.position.x -= 0.9;
        carFender2.position.z += 0.8;
        carFender2.position.y += 0.1;

        var carFender3 = new THREE.Mesh(carFenderGeom, darkGrayMaterial);
        carFender3.rotateY(Math.PI / 2);
        carFender3.position.x += 0.8;
        carFender3.position.z -= 0.8;
        carFender3.position.y += 0.1;

        var carFender4 = new THREE.Mesh(carFenderGeom, darkGrayMaterial);
        carFender4.rotateY(Math.PI / 2);
        carFender4.position.x += 0.8;
        carFender4.position.z += 0.8;
        carFender4.position.y += 0.1;

        var carRearShape = new THREE.Shape();
        carRearShape.moveTo(-0.8, 0.3);
        carRearShape.lineTo(-0.6, 0.3);
        carRearShape.lineTo(-0.3, 0.1);
        carRearShape.lineTo(0.3, 0.1);
        carRearShape.lineTo(0.6, 0.3);
        carRearShape.lineTo(0.8, 0.3);
        carRearShape.lineTo(0.8, -0.3);
        carRearShape.lineTo(-0.8, -0.3);
        carRearShape.lineTo(-0.8, 0.3);
        var carRearGeom = new THREE.ExtrudeGeometry(carRearShape, extrudeSettings);
        var carRear = new THREE.Mesh(carRearGeom, redMaterial);
        // carRear.rotateY(Math.PI / 2);
        carRear.position.z -= 1.3;
        carRear.position.y += 0.3;

        var carDoorShape = new THREE.Shape();
        carDoorShape.moveTo(-0.7, 0.3);
        carDoorShape.lineTo(-0.6, 0.5);
        carDoorShape.lineTo(0, 0.5);
        carDoorShape.lineTo(0, -0.5);
        carDoorShape.lineTo(-0.6, -0.5);
        carDoorShape.lineTo(-0.7, -0.2);
        carDoorShape.lineTo(-0.7, 0.3);
        var carDoorHolePath = new THREE.Path();
        carDoorHolePath.moveTo(-0.55, 0.4);
        carDoorHolePath.lineTo(-0.1, 0.4);
        carDoorHolePath.lineTo(-0.1, -0.3);
        carDoorHolePath.lineTo(-0.55, -0.3);
        carDoorHolePath.lineTo(-0.55, 0.4);
        carDoorShape.holes = [carDoorHolePath];
        var carDoorGeom = new THREE.ExtrudeGeometry(carDoorShape, extrudeSettings);

        var doorWindowShape = new THREE.Shape();
        doorWindowShape.moveTo(-0.55, 0.2);
        doorWindowShape.lineTo(-0.1, 0.2);
        doorWindowShape.lineTo(-0.1, -0.3);
        doorWindowShape.lineTo(-0.55, -0.3);
        doorWindowShape.lineTo(-0.55, 0.2);
        var doorWindowGeom = new THREE.ExtrudeGeometry(doorWindowShape, extrudeSettings);

        var carDoor1 = new THREE.Mesh(carDoorGeom, redMaterial);
        var carDoor2 = new THREE.Mesh(carDoorGeom, redMaterial);
        var doorWindow1 = new THREE.Mesh(doorWindowGeom, windowMaterial);
        var doorWindow2 = new THREE.Mesh(doorWindowGeom, windowMaterial);
        carDoor1.rotateY(-Math.PI / 2);
        carDoor2.rotateY(-Math.PI / 2);
        carDoor1.position.x -= 0.7;
        carDoor1.position.z += 0.2;
        carDoor1.position.y += 0.8;
        carDoor2.position.x += 0.8;
        carDoor2.position.z += 0.2;
        carDoor2.position.y += 0.8;

        carDoor1.add(doorWindow1);
        carDoor2.add(doorWindow2);

        var rearMirror1 = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.03, 0.1, 128, 1), darkGrayMaterial);
        rearMirror1.position.z += 0.15;
        rearMirror1.position.x += 0.02;
        rearMirror1.rotateX(Math.PI / 2);
        var rearMirror2 = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.03, 0.1, 128, 1), darkGrayMaterial);
        rearMirror2.position.z -= 0.05;
        rearMirror2.position.x -= 0.02;
        rearMirror2.rotateX(Math.PI / 2);

        var rearMirrorBody1 = new THREE.Mesh(new THREE.BoxGeometry(0.03, 0.2, 0.15, 1, 1, 1), redMaterial);
        rearMirrorBody1.position.y += 0.1;
        var rearMirrorBody2 = new THREE.Mesh(new THREE.BoxGeometry(0.03, 0.2, 0.15, 1, 1, 1), redMaterial);
        rearMirrorBody2.position.y -= 0.1;

        rearMirror1.add(rearMirrorBody1);
        rearMirror2.add(rearMirrorBody2);

        carDoor1.add(rearMirror1);
        carDoor2.add(rearMirror2);

        var carHoodTopShape = new THREE.Shape();
        carHoodTopShape.moveTo(-0.8, 0);
        carHoodTopShape.lineTo(0.8, 0);
        carHoodTopShape.lineTo(0.8, -0.8);
        carHoodTopShape.lineTo(0.5, -0.8);
        carHoodTopShape.lineTo(0.5, -0.9);
        carHoodTopShape.lineTo(-0.5, -0.9);
        carHoodTopShape.lineTo(-0.5, -0.8);
        carHoodTopShape.lineTo(-0.8, -0.8);
        carHoodTopShape.lineTo(-0.8, -0.8);
        carHoodTopShape.lineTo(-0.8, 0);
        var carHoodTopGeom = new THREE.ExtrudeGeometry(carHoodTopShape, extrudeSettings);
        var carHoodTop = new THREE.Mesh(carHoodTopGeom, darkRedMaterial);
        carHoodTop.rotateX(-Math.PI / 2);
        carHoodTop.position.z += 0.5;
        carHoodTop.position.y += 0.5;

        var carHoodFrontShape = new THREE.Shape();
        carHoodFrontShape.moveTo(-0.5, 0.15);
        carHoodFrontShape.lineTo(0.5, 0.15);
        carHoodFrontShape.lineTo(0.5, -0.15);
        carHoodFrontShape.lineTo(-0.5, -0.15);
        carHoodFrontShape.lineTo(-0.5, 0.15);

        var carHoodFrontHole = new THREE.Path();
        carHoodFrontHole.moveTo(-0.33, 0.12);
        carHoodFrontHole.lineTo(-0.27, 0.12);
        carHoodFrontHole.lineTo(-0.27, -0.12);
        carHoodFrontHole.lineTo(-0.33, -0.12);
        carHoodFrontHole.lineTo(-0.33, 0.12);
        carHoodFrontShape.holes.push(carHoodFrontHole);

        carHoodFrontHole = new THREE.Path();
        carHoodFrontHole.moveTo(-0.13, 0.12);
        carHoodFrontHole.lineTo(-0.07, 0.12);
        carHoodFrontHole.lineTo(-0.07, -0.12);
        carHoodFrontHole.lineTo(-0.13, -0.12);
        carHoodFrontHole.lineTo(-0.13, 0.12);
        carHoodFrontShape.holes.push(carHoodFrontHole);

        carHoodFrontHole = new THREE.Path();
        carHoodFrontHole.moveTo(0.13, 0.12);
        carHoodFrontHole.lineTo(0.07, 0.12);
        carHoodFrontHole.lineTo(0.07, -0.12);
        carHoodFrontHole.lineTo(0.13, -0.12);
        carHoodFrontHole.lineTo(0.13, 0.12);
        carHoodFrontShape.holes.push(carHoodFrontHole);

        carHoodFrontHole = new THREE.Path();
        carHoodFrontHole.moveTo(0.33, 0.12);
        carHoodFrontHole.lineTo(0.27, 0.12);
        carHoodFrontHole.lineTo(0.27, -0.12);
        carHoodFrontHole.lineTo(0.33, -0.12);
        carHoodFrontHole.lineTo(0.33, 0.12);
        carHoodFrontShape.holes.push(carHoodFrontHole);

        var carHoodFrontGeom = new THREE.ExtrudeGeometry(carHoodFrontShape, extrudeSettings);
        var carHoodFront = new THREE.Mesh(carHoodFrontGeom, darkRedMaterial);
        carHoodFront.rotateX(-Math.PI / 2);
        carHoodFront.position.y -= 0.9;
        carHoodFront.position.z -= 0.15;

        carHoodTop.add(carHoodFront);


        var carTrunkTopShape = new THREE.Shape();
        carTrunkTopShape.moveTo(-0.8, 0);
        carTrunkTopShape.lineTo(0.8, 0);
        carTrunkTopShape.lineTo(0.8, -0.8);
        carTrunkTopShape.lineTo(-0.8, -0.8);
        carTrunkTopShape.lineTo(-0.8, 0);
        var carTrunkTopGeom = new THREE.ExtrudeGeometry(carTrunkTopShape, extrudeSettings);
        var carTrunkTop = new THREE.Mesh(carTrunkTopGeom, darkRedMaterial);
        carTrunkTop.rotateX(Math.PI / 2);
        carTrunkTop.position.z -= 0.5;
        carTrunkTop.position.y += 0.7;

        var carTrunkFrontShape = new THREE.Shape();
        carTrunkFrontShape.moveTo(-0.6, 0.3);
        carTrunkFrontShape.lineTo(0.6, 0.3);
        carTrunkFrontShape.lineTo(0.3, 0.1);
        carTrunkFrontShape.lineTo(-0.3, 0.1);
        carTrunkFrontShape.lineTo(-0.6, 0.3);
        var carTrunkFrontGeom = new THREE.ExtrudeGeometry(carTrunkFrontShape, extrudeSettings);
        var carTrunkFront = new THREE.Mesh(carTrunkFrontGeom, darkRedMaterial);
        carTrunkFront.rotateX(-Math.PI / 2);
        carTrunkFront.position.z += 0.4;
        carTrunkFront.position.y -= 0.8;
        carTrunkTop.add(carTrunkFront);

        var carRoofShape = new THREE.Shape();
        carRoofShape.moveTo(-0.7, -0.2);
        carRoofShape.lineTo(-0.55, -0.2);
        carRoofShape.lineTo(-0.55, -0.1);
        carRoofShape.lineTo(0, -0.1);
        carRoofShape.lineTo(0, 0);
        carRoofShape.lineTo(-0.6, 0);
        carRoofShape.lineTo(-0.7, -0.2);
        var carRoofGeom = new THREE.ExtrudeGeometry(carRoofShape, {
            steps: 2,
            depth: 1.4,
            bevelEnabled: false
        });
        var carRoof = new THREE.Mesh(carRoofGeom, darkRedMaterial);
        carRoof.rotateY(-Math.PI / 2);
        carRoof.position.y += 1.3;
        carRoof.position.x += 0.7;
        carRoof.position.z += 0.2;

        var carRearWindow = new THREE.Mesh(new THREE.BoxGeometry(1.4, 0.5, 0.1, 1, 1, 1), windowMaterial);
        carRearWindow.rotateY(Math.PI / 2);
        carRearWindow.position.x -= 0.65;
        carRearWindow.position.y -= 0.45;
        carRearWindow.position.z += 0.7;

        var carFrontWindow = new THREE.Mesh(new THREE.BoxGeometry(1.4, 0.5, 0.1, 1, 1, 1), windowMaterial);
        carFrontWindow.rotateY(Math.PI / 2);
        carFrontWindow.position.x -= 0.05;
        carFrontWindow.position.y -= 0.35;
        carFrontWindow.position.z += 0.7;

        var carWindowFrame = new THREE.Mesh(new THREE.BoxGeometry(1.4, 0.35, 0.05, 1, 1, 1), darkRedMaterial);
        carWindowFrame.rotateY(Math.PI / 2);
        carWindowFrame.rotateX(-Math.tan(4 / 5.2));
        carWindowFrame.position.x += 0.15;
        carWindowFrame.position.y -= 0.67;
        carWindowFrame.position.z += 0.7;

        carRoof.add(carRearWindow);
        carRoof.add(carFrontWindow);
        carRoof.add(carWindowFrame);

        var carRimGeom = new THREE.ExtrudeGeometry(gearShape(0.05, 0.22), extrudeSettings);

        var carTire1 = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 0.15, 128, 128), blackMaterial);
        var carRim1 = new THREE.Mesh(carRimGeom, metalMaterial);
        carRim1.rotateX(Math.PI / 2);
        carTire1.add(carRim1);
        carTire1.rotateZ(Math.PI / 2);
        carTire1.position.x += 0.8;
        carTire1.position.z += 0.8;

        var carTire2 = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 0.15, 128, 128), blackMaterial);
        var carRim2 = new THREE.Mesh(carRimGeom, metalMaterial);
        carRim2.rotateX(Math.PI / 2);
        carTire2.add(carRim2);
        carTire2.rotateZ(-Math.PI / 2);
        carTire2.position.x -= 0.8;
        carTire2.position.z += 0.8;

        var carTire3 = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 0.15, 128, 128), blackMaterial);
        var carRim3 = new THREE.Mesh(carRimGeom, metalMaterial);
        carRim3.rotateX(Math.PI / 2);
        carTire3.add(carRim3);
        carTire3.rotateZ(Math.PI / 2);
        carTire3.position.x += 0.8;
        carTire3.position.z -= 0.8;

        var carTire4 = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 0.15, 128, 128), blackMaterial);
        var carRim4 = new THREE.Mesh(carRimGeom, metalMaterial);
        carRim4.rotateX(Math.PI / 2);
        carTire4.add(carRim4);
        carTire4.rotateZ(-Math.PI / 2);
        carTire4.position.x -= 0.8;
        carTire4.position.z -= 0.8;

        car.add(carBottom);
        car.add(carFront);
        car.add(carSide1);
        car.add(carSide2);
        car.add(carFender1);
        car.add(carFender2);
        car.add(carFender3);
        car.add(carFender4);
        car.add(carRear);
        car.add(carDoor1);
        car.add(carDoor2);
        car.add(carHoodTop);
        car.add(carTrunkTop);
        car.add(carRoof);
        car.add(carTire1);
        car.add(carTire2);
        car.add(carTire3);
        car.add(carTire4);

        var manager = new THREE.LoadingManager();
        manager.onStart = function(url, itemsLoaded, itemsTotal) {
            console.log('Started loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.');
        };

        manager.onLoad = function() {
            console.log('Loading complete!');
        };


        manager.onProgress = function(url, itemsLoaded, itemsTotal) {
            console.log('Loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.');
        };

        manager.onError = function(url) {
            console.log('There was an error loading ' + url);
        };

        var prop1 = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.03, 0.03, 1, 1, 1), darkGrayMaterial);
        var prop2 = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.03, 0.03, 1, 1, 1), darkGrayMaterial);
        var prop3 = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.03, 0.03, 1, 1, 1), darkGrayMaterial);
        var prop4 = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.03, 0.03, 1, 1, 1), darkGrayMaterial);
        var drone = new THREE.Object3D();
        var loader = new THREE.OBJLoader(manager);
        loader.load('drone/model.obj', function(object) {
            drone = object;
            prop1.position.y += 0.1;
            prop1.position.x += 0.15;
            prop1.position.z += 0.57;
            object.add(prop1);
            prop2.position.y += 0.1;
            prop2.position.x -= 0.15;
            prop2.position.z -= 0.57;
            object.add(prop2);
            prop3.position.y += 0.1;
            prop3.position.x -= 0.57;
            prop3.position.z += 0.15;
            object.add(prop3);
            prop4.position.y += 0.1;
            prop4.position.x += 0.57;
            prop4.position.z -= 0.15;
            object.add(prop4);
            object.position.y += 1.45;
            car.add(object);
        });
        car.position.z -= 10;

        // Plane
        var planeGeom = new THREE.PlaneGeometry(40, 40, 40, 10);
        var plane = new THREE.Mesh(planeGeom, darkGrayMaterial);
        plane.geometry.rotateX(-Math.PI / 2);
        plane.position.y -= 0.25;


        // Carousel
        var carousel = new THREE.Mesh(new THREE.CylinderGeometry(2, 2, 0.1, 128, 1), lightBlueMaterial);
        var loader = new THREE.OBJLoader(manager);
        var horse1 = new THREE.Object3D();
        var horse2 = new THREE.Object3D();
        var horse3 = new THREE.Object3D();
        var horse4 = new THREE.Object3D();
        var horse5 = new THREE.Object3D();

        loader.load('horse/WildHorse.obj', function(object) {
            horse1 = object;
            object.scale.set(0.08, 0.08, 0.08);
            object.rotateY(Math.PI * 2 / 5);
            object.position.x -= 0.5253;
            object.position.z += 1.6167;
            object.position.y += 0.2;
            var tube = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 2, 128, 1), darkGrayMaterial);
            tube.position.x -= 0.5253;
            tube.position.z += 1.6167;
            tube.position.y += 1;
            carousel.add(tube);
            carousel.add(object);
        });
        loader.load('horse/WildHorse.obj', function(object) {
            horse2 = object;
            object.scale.set(0.08, 0.08, 0.08);
            object.rotateY(Math.PI * 2 / 5 * 2);
            object.position.x -= -1.3753;
            object.position.z += 0.9992;
            object.position.y += 0.1;
            var tube = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 2, 128, 1), darkGrayMaterial);
            tube.position.x -= -1.3753;
            tube.position.z += 0.9992;
            tube.position.y += 1;
            carousel.add(tube);
            carousel.add(object);
        });
        loader.load('horse/WildHorse.obj', function(object) {
            horse3 = object;
            object.scale.set(0.08, 0.08, 0.08);
            object.rotateY(Math.PI * 2 / 5 * 3);
            object.position.x -= -1.3753;
            object.position.z += -0.9992;
            object.position.y += 0.9;
            var tube = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 2, 128, 1), darkGrayMaterial);
            tube.position.x -= -1.3753;
            tube.position.z += -0.9992;
            tube.position.y += 1;
            carousel.add(tube);
            carousel.add(object);
        });
        loader.load('horse/WildHorse.obj', function(object) {
            horse4 = object;
            object.scale.set(0.08, 0.08, 0.08);
            object.rotateY(Math.PI * 2 / 5 * 4);
            object.position.x -= 0.5253;
            object.position.z += -1.6167;
            object.position.y += 0.5;
            var tube = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 2, 128, 1), darkGrayMaterial);
            tube.position.x -= 0.5253;
            tube.position.z += -1.6167;
            tube.position.y += 1;
            carousel.add(tube);
            carousel.add(object);
        });
        loader.load('horse/WildHorse.obj', function(object) {
            horse5 = object;
            object.scale.set(0.08, 0.08, 0.08);
            object.rotateY(Math.PI * 2 / 5 * 5);
            object.position.x -= 1.7;
            object.position.z += 0;
            object.position.y += 0.8;
            var tube = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 2, 128, 1), darkGrayMaterial);
            tube.position.x -= 1.7;
            tube.position.z += 0;
            tube.position.y += 1;
            carousel.add(tube);
            carousel.add(object);
        });

        centerCarousel = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 2, 128, 1), lightBlueMaterial);
        centerCarousel.position.y += 1;
        carousel.add(centerCarousel);

        var carouselTop = new THREE.Mesh(new THREE.ConeGeometry(2.5, 2.5, 8, 1), darkGrayMaterial);
        carouselTop.position.y += 3.2;

        var carouselComplete = new THREE.Object3D();
        carouselComplete.add(carousel);
        carouselComplete.add(carouselTop);

        carouselComplete.position.x += 10;

        var ferrisWheel = new THREE.Object3D();
        var ferrisOutline1 = new THREE.Mesh(new THREE.TorusGeometry(3, 0.1, 4, 256), darkGrayMaterial);
        ferrisOutline1.position.z += 0.5;
        var ferrisOutline2 = new THREE.Mesh(new THREE.TorusGeometry(3, 0.1, 4, 256), darkGrayMaterial);
        ferrisOutline2.position.z -= 0.5;
        ferrisWheel.add(ferrisOutline1);
        ferrisWheel.add(ferrisOutline2);

        var ferrisStar1Geom = new THREE.ExtrudeGeometry(gearShape(3, 0.5), extrudeSettings);
        var ferrisStar2Geom = new THREE.ExtrudeGeometry(gearShape(3, 0.5), extrudeSettings);
        var ferrisStar1 = new THREE.Mesh(ferrisStar1Geom, darkGrayMaterial);
        ferrisStar1.position.z += 0.5;
        var ferrisStar2 = new THREE.Mesh(ferrisStar2Geom, darkGrayMaterial);
        ferrisStar2.position.z -= 0.5;
        ferrisWheel.add(ferrisStar1);
        ferrisWheel.add(ferrisStar2);

        var basket1 = new THREE.Object3D();
        var basket2 = new THREE.Object3D();
        var basket3 = new THREE.Object3D();
        var basket4 = new THREE.Object3D();

        loader.load('basket/model.obj', function(object) {
            basket1 = object;
            object.scale.set(0.4, 0.4, 0.4);
            object.position.x -= 3.2;
            object.position.y += 0;

            ferrisWheel.add(object);
        });
        loader.load('basket/model.obj', function(object) {
            basket2 = object;
            object.scale.set(0.4, 0.4, 0.4);
            object.position.x += 3.2;
            object.position.y += 0;

            ferrisWheel.add(object);
        });
        loader.load('basket/model.obj', function(object) {
            basket3 = object;
            object.scale.set(0.4, 0.4, 0.4);
            object.position.x += 0;
            object.position.y += 3.2;

            ferrisWheel.add(object);
        });
        loader.load('basket/model.obj', function(object) {
            basket4 = object;
            object.scale.set(0.4, 0.4, 0.4);
            object.position.x += 0;
            object.position.y -= 3.2;

            ferrisWheel.add(object);
        });

        ferrisWheel.position.y += 4;

        var ferrisWheelComplete = new THREE.Object3D();
        var ferrisWheelBase = new THREE.Object3D();
        var base1 = new THREE.Mesh(new THREE.BoxGeometry(5, 0.5, 0.1), darkGrayMaterial);
        base1.rotateZ(Math.PI / 3);
        base1.position.y += 1.8;
        base1.position.z += 0.65;
        base1.position.x -= 1;
        var base2 = new THREE.Mesh(new THREE.BoxGeometry(5, 0.5, 0.1), darkGrayMaterial);
        base2.rotateZ(-Math.PI / 3);
        base2.position.y += 1.8;
        base2.position.z += 0.65;
        base2.position.x += 1;
        var base3 = new THREE.Mesh(new THREE.BoxGeometry(5, 0.5, 0.1), darkGrayMaterial);
        base3.rotateZ(Math.PI / 3);
        base3.position.y += 1.8;
        base3.position.z -= 0.55;
        base3.position.x -= 1;
        var base4 = new THREE.Mesh(new THREE.BoxGeometry(5, 0.5, 0.1), darkGrayMaterial);
        base4.rotateZ(-Math.PI / 3);
        base4.position.y += 1.8;
        base4.position.z -= 0.55;
        base4.position.x += 1;
        var base5 = new THREE.Mesh(new THREE.BoxGeometry(6, 0.5, 3), darkGrayMaterial);

        ferrisWheelBase.add(base1);
        ferrisWheelBase.add(base2);
        ferrisWheelBase.add(base3);
        ferrisWheelBase.add(base4);
        ferrisWheelBase.add(base5);

        ferrisWheelComplete.add(ferrisWheel);
        ferrisWheelComplete.add(ferrisWheelBase);

        ferrisWheelComplete.position.x += 10;
        ferrisWheelComplete.position.z -= 10;

        // Frisbee
        var frisbeeComplete = new THREE.Object3D();

        var frisbeBase = new THREE.Object3D();
        base1 = new THREE.Mesh(new THREE.BoxGeometry(8, 0.5, 0.1), darkGrayMaterial);
        base1.rotateZ(Math.PI / 20 * 8);
        base1.position.y += 3.8;
        base1.position.z += 2;
        base1.position.x -= 1;
        base2 = new THREE.Mesh(new THREE.BoxGeometry(8, 0.5, 0.1), darkGrayMaterial);
        base2.rotateZ(-Math.PI / 20 * 8);
        base2.position.y += 3.8;
        base2.position.z += 2;
        base2.position.x += 1;
        base3 = new THREE.Mesh(new THREE.BoxGeometry(8, 0.5, 0.1), darkGrayMaterial);
        base3.rotateZ(Math.PI / 20 * 8);
        base3.position.y += 3.8;
        base3.position.z -= 2;
        base3.position.x -= 1;
        base4 = new THREE.Mesh(new THREE.BoxGeometry(8, 0.5, 0.1), darkGrayMaterial);
        base4.rotateZ(-Math.PI / 20 * 8);
        base4.position.y += 3.8;
        base4.position.z -= 2;
        base4.position.x += 1;
        base5 = new THREE.Mesh(new THREE.BoxGeometry(6, 0.5, 5), darkGrayMaterial);
        var base6 = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 4, 128, 1), darkGrayMaterial);
        base6.rotateX(Math.PI / 2);
        base6.position.y += 7;
        frisbeBase.add(base1);
        frisbeBase.add(base2);
        frisbeBase.add(base3);
        frisbeBase.add(base4);
        frisbeBase.add(base5);
        frisbeBase.add(base6);

        var frisbee = new THREE.Object3D();
        var frisbeeArm = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 4, 128, 1), darkGrayMaterial);
        frisbee.add(frisbeeArm);
        frisbeeArm.position.y += 2;

        var frisbeeDisc = new THREE.Mesh(new THREE.TorusGeometry(1.4, 0.16, 128, 128), darkGrayMaterial);
        frisbeeDisc.rotateX(Math.PI / 2);
        frisbee.add(frisbeeDisc);
        frisbeeDisc.position.y += 4;

        var frisbeeDiscStarGeom = new THREE.ExtrudeGeometry(gearShape(1.4, 0.3), extrudeSettings);
        var frisbeeDiscStar = new THREE.Mesh(frisbeeDiscStarGeom, darkGrayMaterial);
        frisbeeDiscStar.rotateX(Math.PI / 2);
        frisbee.add(frisbeeDiscStar);
        frisbeeDiscStar.position.y += 4;

        frisbee.position.y += 7;

        frisbeeComplete.add(frisbeBase);
        frisbeeComplete.add(frisbee);

        frisbeeComplete.position.x += 10;
        frisbeeComplete.position.z += 10;

        var pisa = new THREE.Object3D();
        var pisaBase = new THREE.Object3D();
        pisaBase.add(new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 2.5, 128, 1), marble1Material));
        addColumns(pisaBase, 20, 1.50, 0.1, 2.5, marble2Material);
        pisa.add(pisaBase);

        var pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 1.5;
        pisa.add(pisaMid);
        var pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 1, 128, 1), marble1Material);
        addColumns(pisaFloor, 30, 1.50, 0.1, 1, marble2Material);
        pisaFloor.position.y += 2.2;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 2.9;
        pisa.add(pisaMid);
        pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 1, 128, 1), marble1Material);
        addColumns(pisaFloor, 30, 1.50, 0.1, 1, marble2Material);
        pisaFloor.position.y += 3.6;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 4.3;
        pisa.add(pisaMid);
        pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 1, 128, 1), marble1Material);
        addColumns(pisaFloor, 30, 1.50, 0.1, 1, marble2Material);
        pisaFloor.position.y += 4.9;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 5.6;
        pisa.add(pisaMid);
        pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 1, 128, 1), marble1Material);
        addColumns(pisaFloor, 30, 1.50, 0.1, 1, marble2Material);
        pisaFloor.position.y += 6.3;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 6.9;
        pisa.add(pisaMid);
        pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 1, 128, 1), marble1Material);
        addColumns(pisaFloor, 30, 1.50, 0.1, 1, marble2Material);
        pisaFloor.position.y += 7.6;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 8.3;
        pisa.add(pisaMid);
        pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 1.2, 1, 128, 1), marble1Material);
        addColumns(pisaFloor, 30, 1.50, 0.1, 1, marble2Material);
        pisaFloor.position.y += 8.9;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.7, 1.7, 0.4, 128, 1), marble2Material);
        pisaMid.position.y += 9.6;
        pisa.add(pisaMid);
        pisaFloor = new THREE.Mesh(new THREE.CylinderGeometry(1, 1, 1.3, 128, 1), marble1Material);
        addColumns(pisaFloor, 25, 1.3, 0.1, 1, marble2Material);
        pisaFloor.position.y += 10.3;
        pisa.add(pisaFloor);
        pisaMid = new THREE.Mesh(new THREE.CylinderGeometry(1.4, 1.4, 0.2, 128, 1), marble2Material);
        pisaMid.position.y += 10.9;
        pisa.add(pisaMid);

        pisa.position.y += 1;
        pisa.position.x -= 10;
        pisa.rotation.z -= 0.1;


        scene.add(plane);
        scene.add(car);
        scene.add(carouselComplete);
        scene.add(ferrisWheelComplete);
        scene.add(frisbeeComplete);
        scene.add(pisa);

        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        camera.position.z = cam_zpos;
        camera.position.y = cam_ypos;

        // create  point lights
        var pointLight = new THREE.PointLight(0xFFFFFF);
        var pointLight2 = new THREE.PointLight(0xFFFFAA);

        pointLight.position.x = 40;
        pointLight.position.y = 50;
        pointLight.position.z = 40;

        scene.add(pointLight);

        pointLight2.position.x = -40;
        pointLight2.position.y = 50;
        pointLight2.position.z = -40;

        scene.add(pointLight2);

        renderer.setClearColor(0xFAF5DB, 1);

        var render = function() {
            requestAnimationFrame(render);
            camera.position.x = cam_xpos;
            camera.position.z = cam_zpos;
            camera.rotation.y = ang_rad;

            frisbee.rotation.z += 0.03;
            frisbeeDiscStar.rotation.z += 0.05;

            ferrisWheel.rotation.z += 0.01;
            basket1.rotation.z -= 0.01
            basket2.rotation.z -= 0.01
            basket3.rotation.z -= 0.01
            basket4.rotation.z -= 0.01

            if (droneReleased) {
                if (drone.position.y < 2.5) {
                    drone.position.y += 0.1;
                }
                prop1.rotation.y += 0.5;
                prop2.rotation.y += 0.5;
                prop3.rotation.y += 0.5;
                prop4.rotation.y += 0.5;
            } else {
                if (drone.position.y > 1.45) {
                    drone.position.y -= 0.1;
                }
            }

            if (horse1Up && horse1.position.y < 0.9) {
                horse1.position.y += 0.02;
            } else if (horse1Up) {
                horse1Up = !horse1Up;
            } else if (!horse1Up && horse1.position.y > 0.1) {
                horse1.position.y -= 0.02;
            } else {
                horse1Up = !horse1Up;
            }

            if (horse2Up && horse2.position.y < 0.9) {
                horse2.position.y += 0.02;
            } else if (horse2Up) {
                horse2Up = !horse2Up;
            } else if (!horse2Up && horse2.position.y > 0.1) {
                horse2.position.y -= 0.02;
            } else {
                horse2Up = !horse2Up;
            }

            if (horse3Up && horse3.position.y < 0.9) {
                horse3.position.y += 0.02;
            } else if (horse3Up) {
                horse3Up = !horse3Up;
            } else if (!horse3Up && horse3.position.y > 0.1) {
                horse3.position.y -= 0.02;
            } else {
                horse3Up = !horse3Up;
            }

            if (horse4Up && horse4.position.y < 0.9) {
                horse4.position.y += 0.02;
            } else if (horse4Up) {
                horse4Up = !horse4Up;
            } else if (!horse4Up && horse4.position.y > 0.1) {
                horse4.position.y -= 0.02;
            } else {
                horse4Up = !horse4Up;
            }

            if (horse5Up && horse5.position.y < 0.9) {
                horse5.position.y += 0.02;
            } else if (horse5Up) {
                horse5Up = !horse5Up;
            } else if (!horse5Up && horse5.position.y > 0.1) {
                horse5.position.y -= 0.02;
            } else {
                horse5Up = !horse5Up;
            }

            carousel.rotation.y += 0.015;

            renderer.render(scene, camera);
        };

        function gearShape(r1, r2) {
            var shape = new THREE.Shape();
            shape.moveTo(r1, 0);
            var angle = 0;
            for (i = 0; i < 12; i++) {
                shape.lineTo(r1 * Math.cos(angle), r1 * Math.sin(angle));
                angle += 1 / 18 * Math.PI;
                shape.lineTo(r1 * Math.cos(angle), r1 * Math.sin(angle));
                angle += 1 / 36 * Math.PI;
                shape.lineTo(r2 * Math.cos(angle), r2 * Math.sin(angle));
                angle += 1 / 18 * Math.PI;
                shape.lineTo(r2 * Math.cos(angle), r2 * Math.sin(angle));
                angle += 1 / 36 * Math.PI;
            }
            shape.lineTo(r1, 0);

            return (shape);
        }

        function addColumns(object, n, objectRadius, columnRadius, columnHeight, material) {
            let divAngle = Math.PI * 2 / n;
            for (let i = 0; i < n; i++) {
                let x = objectRadius * Math.cos(divAngle * i);
                let z = objectRadius * Math.sin(divAngle * i);
                let c = new THREE.Mesh(new THREE.CylinderGeometry(columnRadius, columnRadius, columnHeight, 128, 1), material);
                object.add(c);
                c.position.x = x;
                c.position.z = z;
            }
        }

        render();
    </script>
</body>

</html>